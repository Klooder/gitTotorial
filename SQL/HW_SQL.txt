1. Показать издательства и сумму страниц по каждому из них

USE Library

SELECT Press.Name, SUM(Books.NPages)
FROM Books, Press
WHERE Id_Press = Press.ID
GROUP BY Press.Name

2. Показать общее кол-во книг, взятых студентами факультета "Программирования" 

USE Library

SELECT Faculties.Name, COUNT(*) AS [Books]
FROM S_Cards, groups, Books, Faculties, Students
WHERE groups.id_faculty=Faculties.ID
	AND S_Cards.Id_Book = Books.ID
	AND S_Cards.Id_Student=Students.ID
	AND Students.Id_Group=groups.id
	AND Faculties.Name = 'Программирования'
GROUP BY Faculties.Name

3. Вывести кол-во книг и сумму страниц этих книг по каждому из издательств 'Питер', 'Наука', 'Кудиц-Образ'.

USE Library

SELECT Press.[Name], SUM(Books.NPages) AS Pages, COUNT (Books.[Name]) AS Books 
FROM Books, Press
WHERE 
	Books.Id_Press = Press.ID
	AND Press.Name IN ('Питер' , 'Наука', 'Кудиц-Образ')
GROUP BY Press.[Name]

4. Вывести информацию о книге по программированию с наибольшим количеством страниц

USE Library
SELECT  Books.Name, Books.NPages, Books.YearPress, Books.Comment, Books.Price, themes.NAME
FROM Books, themes
WHERE Books.Id_Themes = themes.ID
	AND themes.NAME = 'Программирование'
	AND Books.NPages =
	(
		SELECT MAX (Books.NPages)
		FROM Books
		WHERE Books.Id_Themes = themes.ID
	);

5. Вывести на экран кол-во взятых книг по каждой из кафедр.

USE Library

SELECT Departments.Name, COUNT(Books.Name) AS Books
FROM Departments, Books, T_Cards, teachers
WHERE T_Cards.Id_Teacher =teachers.ID
	AND T_Cards.Id_Books = Books.ID
	AND teachers.ID_dep = Departments.ID
GROUP BY  Departments.Name

6. Показать издательства и самую старую книгу по каждому из них

SELECT Press.name , books.Name, books.YearPress
FROM press, books
WHERE press.id = books.Id_Press
	AND books.YearPress =
	(
		SELECT MIN (books.YearPress)
		FROM Books
		WHERE books.Id_Press =Press.ID
	);

7. Показать книги, которые брали и преподователи и студенты (исключить повторения)

USE Library

SELECT T_Books.name
FROM (SELECT Books.Name AS name
			 FROM S_Cards, Books
			 WHERE S_Cards.Id_Book = Books.ID) S_Books
			 , (SELECT Books.Name AS name
			 FROM T_Cards, Books
			 WHERE T_Cards.Id_Books = Books.ID) T_Books
WHERE S_Books.name = T_Books.name
GROUP BY T_Books.Name

8. Показать название книги с максимальным кол-вом страниц по каждому из издательств (С начала найти максимум по издательствам, после чего
   вложить этот запрос внутрь поиска по книгам) 

USE Library

SELECT Press.Name ,Books.Name, Books.NPages
FROM Books, Press
WHERE Books.Id_Press = Press.ID
	AND Books.NPages =
	( 
	    SELECT MAX (Books.NPages)
	    FROM Books
	    WHERE Books.Id_Press = Press.ID
	)

9. Если считать общее кол-во книг в библиотеке за 100%, то необходимо подсчитать сколько книг (в % соотношении) брал каждый факультет

USE Library

SELECT Faculties.Name, COUNT(*) AS [Кол-во], ( (COUNT(*)*100)/ (SELECT COUNT(Books.Name) FROM Books)  ) AS [%]
FROM Faculties, groups, Students, S_Cards, Books
WHERE Students.Id_Group = groups.id
	AND groups.id_faculty = Faculties.ID
	AND S_Cards.Id_Book=Books.ID
	AND S_Cards.Id_Student = Students.ID
GROUP BY Faculties.Name

10. Вывести самого популярного автора среди студентов


CREATE VIEW AutorsStatistics_09642
AS
SELECT Authors.Lastname + ' ' + Authors.FirstName as Authors, COUNT(*) AS cnt
FROM Authors, Books, S_Cards
WHERE Authors.ID = books.Id_Author
	AND Books.ID = S_Cards.Id_Book
Group BY Authors.LastName + ' ' + Authors.FirstName;

SELECT *
FROM AutorsStatistics_09642
WHERE cnt =
(
	SELECT MAX(cnt) FROM AutorsStatistics_09642
)



CREATE VIEW AutorsStatistics_09642_T_Cards
AS
SELECT Authors.Lastname + ' ' + Authors.FirstName as Authors, COUNT(*) AS cnt
FROM Authors, Books, T_Cards
WHERE Authors.ID = books.Id_Author
	AND Books.ID = T_Cards.Id_Books
Group BY Authors.LastName + ' ' + Authors.FirstName;

SELECT *
FROM AutorsStatistics_09642_T_Cards
WHERE cnt =
(
	SELECT MAX(cnt) FROM AutorsStatistics_09642_T_Cards
)




